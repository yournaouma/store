<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Moon â€” Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ø´ÙÙ‘Ø±Ø©</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{--orange:#f97316}
    /* ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© visibility: hidden; Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‚Ø¨Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    body{font-family:Inter,ui-sans-serif,system-ui,Arial,Helvetica,sans-serif;background:#fafafa;margin:0;padding:2rem;direction:rtl; visibility: hidden;}
    .card{background:#fff;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);padding:1.25rem;max-width:820px;margin:0 auto}
    h1{color:var(--orange);margin:0 0 0.5rem 0}
    label{display:block;margin-top:0.75rem;font-size:0.95rem;color:#444}
    textarea,input{width:100%;padding:0.6rem;border:1px solid #e6e6e6;border-radius:8px;font-size:0.95rem}
    .row{display:flex;gap:0.5rem;align-items:center;margin-top:0.75rem}
    button{background:var(--orange);color:#fff;border:none;padding:0.6rem 0.9rem;border-radius:8px;cursor:pointer}
    button.secondary{background:#eee;color:#333}
    .small{font-size:0.9rem;color:#666;margin-top:0.5rem}
    .flex-between{display:flex;justify-content:space-between;align-items:center}
    .badge{display:inline-block;background:var(--orange);color:#fff;padding:0.2rem 0.5rem;border-radius:999px;font-weight:600}
    /* toast */
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#111;color:#fff;padding:0.7rem 1rem;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.18);opacity:0;pointer-events:none;transition:all .25s}
    .toast.show{opacity:1;pointer-events:auto;bottom:40px}
    pre{background:#f3f4f6;padding:0.6rem;border-radius:8px;overflow:auto}
    .muted{color:#888;font-size:0.87rem}
  </style>
</head>
<body>

  <!-- ===========================
       Ø³ÙƒØ±Ø¨Øª Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„
       =========================== -->
  <script>
    (function() {
      const correctUsername = "Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡";
      const correctPassword = "0913410252";

      let enteredUsername = prompt("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„:");
      let enteredPassword = prompt("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø²:");

      if (enteredUsername === correctUsername && enteredPassword === correctPassword) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©ØŒ ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø©
        document.body.style.visibility = 'visible';
      } else {
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©ØŒ ÙŠØªÙ… Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ø°ÙŠØ± ÙˆØªØ¨Ù‚Ù‰ Ø§Ù„ØµÙØ­Ø© Ù…Ø®ÙÙŠØ©
        alert("Ø§Ø³Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­. Ø§Ù„ÙˆØµÙˆÙ„ Ù…Ø±ÙÙˆØ¶.");
      }
    })();
  </script>

  <div class="card">
    <div class="flex-between">
      <div>
        <h1><i class="fa fa-moon"></i> Moon â€” Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h1>
        <div class="small">Ø£Ø±Ø³Ù„ Ø¥Ø´Ø¹Ø§Ø±Ù‹Ø§ ÙŠØ¸Ù‡Ø± Ø¯Ø§Ø®Ù„ ØµÙØ­Ø© Ø§Ù„Ù…ØªØ¬Ø±. Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙØ®Ø²Ù† ÙÙŠ <code>localStorage</code> ØªØ­Øª Ø§Ù„Ù…ÙØªØ§Ø­ <code>store_notifications</code>.</div>
      </div>
      <div style="text-align:left">
        <div class="muted">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</div>
        <div style="margin-top:0.3rem"><span id="notifyCount" class="badge">0</span></div>
      </div>
    </div>

    <label>Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ (Ø³ØªÙØ±Ø³Ù„ Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø±):</label>
    <textarea id="msgInput" rows="3" placeholder="Ù…Ø«Ø§Ù„: ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ âœ¨"></textarea>

    <div class="row">
      <button id="sendBtn"><i class="fa fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø±</button>
      <button id="clearBtn" class="secondary"><i class="fa fa-trash"></i> Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</button>
      <div style="margin-left:auto">
        <button id="encryptPhoneBtn" class="secondary"><i class="fa fa-lock"></i> ØªØ´ÙÙŠØ± Ø±Ù‚Ù… (Ø­ÙØ¸ Ù…Ø´ÙÙ‘Ø±)</button>
        <button id="decryptPhoneBtn" class="secondary"><i class="fa fa-unlock"></i> ÙÙƒÙ‘ Ø§Ù„ØªØ´ÙÙŠØ± (Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø³Ø®Ø©)</button>
      </div>
    </div>

    <label>Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Ø¢Ø®Ø± 20 Ø±Ø³Ø§Ù„Ø©):</label>
    <div id="history" style="max-height:220px;overflow:auto;border:1px solid #f1f1f1;padding:0.6rem;border-radius:8px;background:#fff"></div>

    <div class="small" style="margin-top:0.75rem">
      <strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ù…Ø§Ù†:</strong>
      <ul>
        <li>ÙŠÙØ®Ø²Ù‘Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø´ÙÙ‘Ø± ÙÙŠ <code>localStorage</code>. Ù„ÙÙƒÙ‘Ù‡ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù†ÙØ³Ù‡Ø§ Ø§Ù„ØªÙŠ Ø§Ø³ØªÙØ®Ø¯Ù…Øª Ù„Ù„ØªØ´ÙÙŠØ±.</li>
        <li>Ù„Ø§ ØªÙ‚Ù… Ø¨Ù…Ø´Ø§Ø±ÙƒØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø£Ùˆ ØªØ®Ø²ÙŠÙ†Ù‡Ø§ ÙÙŠ Ù†Øµ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¸Ø§Ù‡Ø± Ù„Ù„Ø¹Ø§Ù…Ø©.</li>
      </ul>
    </div>

    <div style="margin-top:0.8rem">
      <label>Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø´ÙÙ‘Ø± (Ù…Ø®Ø²Ù‘Ù†):</label>
      <pre id="cipherDisplay">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´ÙÙ‘Ø±Ø© Ù…Ø­ÙÙˆØ¸Ø©.</pre>
    </div>
  </div>

  <div id="toast" class="toast">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!</div>

<script>
/* ===========================
   Helpers: Web Crypto AESâ€‘GCM
   ===========================
   - Ù†Ø³ØªØ¹Ù…Ù„ PBKDF2 Ù„Ø§Ø´ØªÙ‚Ø§Ù‚ Ù…ÙØªØ§Ø­ Ù…Ù† passphrase
   - Ø«Ù… AES-GCM Ù„Ù„ØªØ´ÙÙŠØ±/ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±
   - Ø§Ù„Ù…Ø®Ø²Ù† Ø³ÙŠÙƒÙˆÙ† JSON ÙŠØ­ØªÙˆÙŠ: {iv: "...", ct: "...", salt: "..."}
*/
async function getKeyFromPassword(password, saltBase64) {
  const enc = new TextEncoder();
  const passwordKey = await crypto.subtle.importKey(
    "raw",
    enc.encode(password),
    {name: "PBKDF2"},
    false,
    ["deriveKey"]
  );
  const salt = saltBase64 ? Uint8Array.from(atob(saltBase64), c => c.charCodeAt(0)) : crypto.getRandomValues(new Uint8Array(16));
  const keyMaterial = await crypto.subtle.deriveKey(
    {name: "PBKDF2", salt: salt, iterations: 100000, hash: "SHA-256"},
    passwordKey,
    {name: "AES-GCM", length: 256},
    false,
    ["encrypt", "decrypt"]
  );
  return {key: keyMaterial, salt: btoa(String.fromCharCode(...salt))};
}

async function encryptText(plainText, password) {
  const enc = new TextEncoder();
  const {key, salt} = await getKeyFromPassword(password, null);
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const cipherBuffer = await crypto.subtle.encrypt(
    {name: "AES-GCM", iv: iv},
    key,
    enc.encode(plainText)
  );
  const ctBase64 = btoa(String.fromCharCode(...new Uint8Array(cipherBuffer)));
  return {ct: ctBase64, iv: btoa(String.fromCharCode(...iv)), salt};
}

async function decryptText(encObj, password) {
  try {
    const dec = new TextDecoder();
    const saltBytes = Uint8Array.from(atob(encObj.salt), c => c.charCodeAt(0));
    const iv = Uint8Array.from(atob(encObj.iv), c => c.charCodeAt(0));
    const ct = Uint8Array.from(atob(encObj.ct), c => c.charCodeAt(0));
    // Ù†Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¹Ø¨Ø± PBKDF2 Ù…Ø¹ Ø§Ù„Ù…Ù„Ø­ Ø°Ø§ØªÙ‡
    const passwordKey = await crypto.subtle.importKey("raw", new TextEncoder().encode(password), {name: "PBKDF2"}, false, ["deriveKey"]);
    const key = await crypto.subtle.deriveKey(
      {name: "PBKDF2", salt: saltBytes, iterations: 100000, hash: "SHA-256"},
      passwordKey,
      {name: "AES-GCM", length: 256},
      false,
      ["decrypt"]
    );
    const plainBuffer = await crypto.subtle.decrypt({name: "AES-GCM", iv: iv}, key, ct);
    return new TextDecoder().decode(plainBuffer);
  } catch (e) {
    throw new Error("ÙØ´Ù„ ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ± â€” ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø© Ø£Ùˆ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ§Ù„ÙØ©.");
  }
}

/* ===========================
   Notification logic (localStorage)
   =========================== */
const STORAGE_KEY = 'store_notifications';
const ENCRYPTED_PHONE_KEY = 'moon_encrypted_phone';

const sendBtn = document.getElementById('sendBtn');
const clearBtn = document.getElementById('clearBtn');
const msgInput = document.getElementById('msgInput');
const historyEl = document.getElementById('history');
const toast = document.getElementById('toast');
const notifyCountEl = document.getElementById('notifyCount');
const cipherDisplay = document.getElementById('cipherDisplay');

function loadNotifications() {
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  } catch {
    return [];
  }
}
function saveNotifications(arr) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
  window.dispatchEvent(new StorageEvent('storage', {key: STORAGE_KEY, newValue: JSON.stringify(arr)}));
}
function renderHistory() {
  const arr = loadNotifications();
  const recent = arr.slice(-20).reverse();
  if (recent.length === 0) {
    historyEl.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ø¹Ø¯.</div>';
  } else {
    historyEl.innerHTML = recent.map(m => `<div style="padding:0.5rem;border-bottom:1px dashed #f1f1f1">${escapeHtml(m)}</div>`).join('');
  }
  notifyCountEl.textContent = arr.length;
}
function escapeHtml(s) {
  return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

function showToast(text="ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!") {
  toast.textContent = text;
  toast.classList.add('show');
  setTimeout(()=> toast.classList.remove('show'), 2200);
}

// Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±
sendBtn.addEventListener('click', () => {
  const text = msgInput.value.trim();
  if (!text) { alert('Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.'); return; }
  const arr = loadNotifications();
  arr.push(text);
  saveNotifications(arr);
  renderHistory();
  msgInput.value = '';
  showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø± âœ…');
});

// Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
clearBtn.addEventListener('click', () => {
  if (!confirm('Ù‡Ù„ ØªÙˆØ¯ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©ØŸ')) return;
  saveNotifications([]);
  renderHistory();
  showToast('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.');
});

/* ===========================
   Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ù† ØªØ¨ÙˆÙŠØ¨Ø§Øª/ØµÙØ­Ø§Øª Ø£Ø®Ø±Ù‰
   =========================== */
window.addEventListener('storage', (e) => {
  if (e.key === STORAGE_KEY) {
    renderHistory();
  } else if (e.key === ENCRYPTED_PHONE_KEY) {
    updateCipherDisplay();
  }
});

/* ===========================
   ØªØ´ÙÙŠØ± Ø§Ù„Ø±Ù‚Ù… ÙˆØ­ÙØ¸ Ø§Ù„Ù…Ø´ÙÙ‘Ø±
   =========================== */
const encryptPhoneBtn = document.getElementById('encryptPhoneBtn');
const decryptPhoneBtn = document.getElementById('decryptPhoneBtn');

encryptPhoneBtn.addEventListener('click', async () => {
  try {
    // Ù†Ø£Ø®Ø° Ø§Ù„Ø±Ù‚Ù… Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ù‚Ù… Ù‡Ù†Ø§ Ù„Ùˆ Ø£Ø±Ø¯Øª)
    const phone = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ ØªØ´ÙÙŠØ±Ù‡ (Ù…Ø«Ø§Ù„: 0913410252):');
    if (!phone) return alert('Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù….');
    const pass = prompt('Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ© Ù„ØªØ´ÙÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…. Ø§Ø­ØªÙØ¸ Ø¨Ù‡Ø§ Ù„Ø£Ù†Ùƒ Ø³ØªØ­ØªØ§Ø¬Ù‡Ø§ Ù„ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±.');
    if (!pass) return alert('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±.');
    const encObj = await encryptText(phone, pass);
    // Ù†Ø®Ø²Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø´ÙÙ‘Ø± ÙƒØ³Ù„Ø³Ù„Ø© JSON
    localStorage.setItem(ENCRYPTED_PHONE_KEY, JSON.stringify(encObj));
    updateCipherDisplay();
    showToast('ØªÙ… ØªØ´ÙÙŠØ± Ø§Ù„Ø±Ù‚Ù… ÙˆØ­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§ ğŸ”');
  } catch (err) {
    alert('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ´ÙÙŠØ±: ' + err.message);
  }
});

decryptPhoneBtn.addEventListener('click', async () => {
  try {
    const stored = localStorage.getItem(ENCRYPTED_PHONE_KEY);
    if (!stored) { alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´ÙÙ‘Ø±Ø© Ù…Ø®Ø²Ù†Ø©.'); return; }
    const encObj = JSON.parse(stored);
    const pass = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ÙÙƒÙ‘ Ø§Ù„ØªØ´ÙÙŠØ±:');
    if (!pass) return;
    const plain = await decryptText(encObj, pass);
    alert('Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙÙƒÙˆÙƒ: ' + plain);
  } catch (err) {
    alert(err.message || 'ÙØ´Ù„ ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±.');
  }
});

function updateCipherDisplay() {
  const s = localStorage.getItem(ENCRYPTED_PHONE_KEY);
  if (!s) {
    cipherDisplay.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´ÙÙ‘Ø±Ø© Ù…Ø­ÙÙˆØ¸Ø©.';
  } else {
    try {
      const o = JSON.parse(s);
      cipherDisplay.textContent = JSON.stringify(o, null, 2);
    } catch (e) {
      cipherDisplay.textContent = s;
    }
  }
}

/* ============= init ============= */
renderHistory();
updateCipherDisplay();

</script>
</body>
</html>
