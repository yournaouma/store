name: 🔄 Update sitemap.xml daily

on:
  schedule:
    - cron: '0 3 * * *'  # ⏰ كل يوم الساعة 3 صباحًا بتوقيت غرينتش
  workflow_dispatch:       # يمكن تشغيله يدويًا أيضًا

permissions:
  contents: write

jobs:
  update-sitemap:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 تحميل المشروع
        uses: actions/checkout@v4

      - name: 🕒 تحديث تواريخ <lastmod> وإزالة الشرطة الزائدة
        run: |
          TODAY=$(date +%Y-%m-%d)
          echo "📅 تحديث التاريخ إلى: ${TODAY}"
          sed -i "s/<lastmod>.*<\/lastmod>/<lastmod>${TODAY}<\/lastmod>/g" store/sitemap.xml
          sed -i "s/\.html\//.html/g" store/sitemap.xml  # إزالة الشرطة الزائدة بعد .html

      - name: 📤 رفع التعديلات إلى GitHub
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add store/sitemap.xml
          git commit -m "🔄 Auto-update sitemap date to ${TODAY}" || echo "No changes to commit"
          git push
